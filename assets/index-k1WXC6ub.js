(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const h of s)if(h.type==="childList")for(const n of h.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function i(s){const h={};return s.integrity&&(h.integrity=s.integrity),s.referrerPolicy&&(h.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?h.credentials="include":s.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function e(s){if(s.ep)return;s.ep=!0;const h=i(s);fetch(s.href,h)}})();class M{constructor(){this.keys={},this.joystick={x:0,y:0,active:!1},this.chargeActive=!1,this.setupKeyboard(),this.setupTouch()}setupKeyboard(){window.addEventListener("keydown",t=>{this.keys[t.code]=!0,t.code==="Space"&&(this.chargeActive=!0)}),window.addEventListener("keyup",t=>{this.keys[t.code]=!1,t.code==="Space"&&(this.chargeActive=!1)})}setupTouch(){const t=document.getElementById("joystick-zone"),i=document.getElementById("action-button");let e,s;const h=(a,o)=>{e=a,s=o,this.joystick.active=!0,this.updateJoystickVisual(0,0)},n=(a,o)=>{if(!this.joystick.active)return;const u=a-e,y=o-s,T=Math.sqrt(u*u+y*y),g=40,x=Math.atan2(y,u),m=Math.min(T,g),w=Math.cos(x)*m,v=Math.sin(x)*m;this.joystick.x=w/g,this.joystick.y=v/g,this.updateJoystickVisual(w,v)},c=()=>{this.joystick.active=!1,this.joystick.x=0,this.joystick.y=0,this.updateJoystickVisual(0,0)};t.addEventListener("touchstart",a=>{a.preventDefault();const o=a.touches[0];h(o.clientX,o.clientY)}),t.addEventListener("touchmove",a=>{a.preventDefault();const o=a.touches[0];n(o.clientX,o.clientY)}),t.addEventListener("touchend",a=>{a.preventDefault(),c()}),t.addEventListener("mousedown",a=>{a.preventDefault(),h(a.clientX,a.clientY)}),window.addEventListener("mousemove",a=>{this.joystick.active&&(a.preventDefault(),n(a.clientX,a.clientY))}),window.addEventListener("mouseup",a=>{this.joystick.active&&(a.preventDefault(),c())});const f=a=>{a.cancelable&&a.preventDefault(),this.chargeActive=!0},l=a=>{a.cancelable&&a.preventDefault(),this.chargeActive=!1};i.addEventListener("touchstart",f),i.addEventListener("touchend",l),i.addEventListener("mousedown",f),i.addEventListener("mouseup",l),i.addEventListener("mouseleave",l)}updateJoystickVisual(t,i){let e=document.querySelector(".joystick-knob");e||(e=document.createElement("div"),e.className="joystick-knob",document.getElementById("joystick-zone").appendChild(e)),e.style.transform=`translate(calc(-50% + ${t}px), calc(-50% + ${i}px))`}getMovement(){let t=0,i=0;if((this.keys.ArrowLeft||this.keys.KeyA)&&(t-=1),(this.keys.ArrowRight||this.keys.KeyD)&&(t+=1),(this.keys.ArrowUp||this.keys.KeyW)&&(i-=1),(this.keys.ArrowDown||this.keys.KeyS)&&(i+=1),t!==0||i!==0){const e=Math.sqrt(t*t+i*i);t/=e,i/=e}return this.joystick.active&&(t=this.joystick.x,i=this.joystick.y),{x:t,y:i}}}class k{constructor(t,i,e){this.ctx=t,this.width=i,this.height=e}resize(t,i){this.width=t,this.height=i}clear(){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle="#0d0d0d",this.ctx.fillRect(0,0,this.width,this.height)}drawPlayer(t){if(this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.shadowBlur=20,this.ctx.shadowColor=t.color,this.ctx.fillStyle=t.invincible?`hsl(${Date.now()%360}, 100%, 50%)`:t.color,this.ctx.beginPath(),this.ctx.arc(0,0,t.radius,0,Math.PI*2),this.ctx.fill(),t.isShaking&&(this.ctx.strokeStyle="#fff",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(0,0,t.radius+8,0,Math.PI*2),this.ctx.stroke()),t.def>3&&(this.ctx.strokeStyle="#ffff00",this.ctx.lineWidth=2+(t.def-3),this.ctx.beginPath(),this.ctx.arc(0,0,t.radius+5+t.def,0,Math.PI*2),this.ctx.stroke()),t.atk>3){this.ctx.fillStyle="#ff0055";const i=t.atk;for(let e=0;e<i;e++){const s=Math.PI*2/i*e,h=Math.cos(s)*(t.radius+10),n=Math.sin(s)*(t.radius+10);this.ctx.beginPath(),this.ctx.arc(h,n,5,0,Math.PI*2),this.ctx.fill()}}t.isCharging&&(this.ctx.strokeStyle="#fff",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(0,0,t.radius+5,0,Math.PI*2),this.ctx.stroke()),this.ctx.restore()}drawBlock(t){if(this.ctx.fillStyle=t.color,this.ctx.fillRect(t.x,t.y,t.width,t.height),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=2,this.ctx.strokeRect(t.x,t.y,t.width,t.height),t.hp<t.maxHp){const i=1-t.hp/t.maxHp;this.ctx.strokeStyle="#000",this.ctx.lineWidth=2,this.ctx.beginPath(),i>.3&&(this.ctx.moveTo(t.x+10,t.y+10),this.ctx.lineTo(t.x+t.width/2,t.y+t.height/2)),i>.6&&(this.ctx.moveTo(t.x+t.width-10,t.y+10),this.ctx.lineTo(t.x+t.width/2,t.y+t.height/2)),i>.8&&(this.ctx.moveTo(t.x+t.width/2,t.y+t.height-10),this.ctx.lineTo(t.x+t.width/2,t.y+t.height/2)),this.ctx.stroke()}}drawItem(t){this.ctx.save(),this.ctx.translate(t.x,t.y);const i=1+Math.sin(t.pulse)*.1;this.ctx.scale(i,i),this.ctx.fillStyle=t.color,this.ctx.shadowBlur=10,this.ctx.shadowColor=t.color,this.ctx.beginPath(),this.ctx.arc(0,0,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.restore()}drawBoss(t){this.ctx.fillStyle=t.color,this.ctx.fillRect(t.x,t.y,t.width,t.height),this.ctx.fillStyle="red",this.ctx.fillRect(t.x,t.y-10,t.width,5),this.ctx.fillStyle="green",this.ctx.fillRect(t.x,t.y-10,t.width*(t.hp/t.maxHp),5)}drawProjectile(t){this.ctx.fillStyle=t.type==="beam"?"#00f0ff":"#ff0055",this.ctx.shadowBlur=10,this.ctx.shadowColor=this.ctx.fillStyle,this.ctx.fillRect(t.x-t.width/2,t.y-t.height/2,t.width,t.height),this.ctx.shadowBlur=0}drawFloatingText(t){this.ctx.save(),this.ctx.globalAlpha=Math.max(0,t.life),this.ctx.fillStyle=t.color,this.ctx.font="bold 20px Inter",this.ctx.textAlign="center",this.ctx.fillText(t.text,t.x,t.y),this.ctx.restore()}}class E{constructor(t,i){this.x=t,this.y=i,this.radius=20,this.speed=300,this.atk=1,this.def=1,this.hp=100,this.color="#00f0ff",this.isCharging=!1,this.weaponType="dash",this.weaponTimer=0,this.chargePower=0,this.isAttacking=!1,this.attackTimer=0,this.invincible=!1,this.invincibleTimer=0,this.lastX=t,this.shakeCount=0,this.shakeTimer=0,this.isShaking=!1}upgrade(t){switch(t){case"atk":this.atk+=1,this.atk>5?this.weaponType="beam":this.atk>3&&(this.weaponType="sword");break;case"spd":this.speed+=20;break;case"def":this.def+=1;break;case"hp":this.hp=Math.min(this.hp+20,100);break}}update(t,i){if(this.invincible&&(this.invincibleTimer-=t,this.invincibleTimer<=0&&(this.invincible=!1,this.speed=300)),i.chargeActive?(this.isCharging=!0,this.chargePower+=t*5,this.chargePower=Math.min(this.chargePower,10)):this.isCharging&&(this.isCharging=!1,this.isAttacking=!0,this.attackTimer=.5,this.chargePower=Math.max(1,this.chargePower)),this.isAttacking)this.attackTimer-=t,this.attackTimer<=0?(this.isAttacking=!1,this.chargePower=0):this.y-=(500+this.chargePower*50)*t;else if(!this.isCharging){const e=i.getMovement();this.shakeTimer+=t,this.shakeTimer>.2&&(this.shakeCount=0,this.shakeTimer=0),Math.sign(e.x)!==Math.sign(this.lastX-this.x)&&Math.abs(e.x)>.8&&(this.shakeCount++,this.shakeTimer=0),this.lastX=this.x,this.shakeCount>3?this.isShaking=!0:this.isShaking=!1,this.x+=e.x*this.speed*t,this.y+=e.y*this.speed*t}this.x=Math.max(this.radius,Math.min(window.innerWidth-this.radius,this.x)),this.y=Math.max(this.radius,Math.min(window.innerHeight-this.radius,this.y))}}class B{constructor(t,i,e,s,h="normal"){this.x=t,this.y=i,this.width=e,this.height=s,this.type=h,this.active=!0,this.hp=(h==="hard"?3:1)*10,this.maxHp=this.hp,this.color=this.getColorByType(h)}getColorByType(t){switch(t){case"hard":return"#ff0055";case"resource":return"#00ff00";default:return"#aaaaaa"}}update(t,i){this.y+=i*t}}class I{constructor(t,i,e){this.x=t,this.y=i,this.radius=15,this.type=e,this.active=!0,this.color=this.getColorByType(e),this.pulse=0}getColorByType(t){switch(t){case"atk":return"#ff0055";case"spd":return"#00f0ff";case"def":return"#ffff00";case"hp":return"#00ff00";case"invincible":return"#ffffff";default:return"#ffffff"}}update(t,i){this.y+=i*t,this.pulse+=t*5}}class S{constructor(t,i){this.x=t,this.y=i,this.width=100,this.height=100,this.hp=100,this.maxHp=100,this.active=!0,this.color="#ff0000",this.state="idle",this.timer=0}update(t,i){this.timer+=t;const e=i.x-(this.x+this.width/2);Math.abs(e)>10&&(this.x+=Math.sign(e)*100*t),this.y=50+Math.sin(this.timer*2)*20}}class p{constructor(t,i,e,s,h){this.x=t,this.y=i,this.vx=e,this.vy=s,this.type=h,this.active=!0,this.width=h==="beam"?20:10,this.height=h==="beam"?40:10,this.color="#fff"}update(t){this.x+=this.vx*t,this.y+=this.vy*t}}class C{constructor(t,i,e,s){this.x=t,this.y=i,this.text=e,this.color=s,this.life=1,this.active=!0,this.vy=-50}update(t){this.life-=t,this.y+=this.vy*t,this.life<=0&&(this.active=!1)}}class d{static checkCollision(t,i){const e=Math.max(i.x,Math.min(t.x,i.x+i.width)),s=Math.max(i.y,Math.min(t.y,i.y+i.height)),h=t.x-e,n=t.y-s;return h*h+n*n<t.radius*t.radius}static checkCircleCollision(t,i){const e=t.x-i.x,s=t.y-i.y;return Math.sqrt(e*e+s*s)<t.radius+i.radius}static resolveCollision(t,i){return this.checkCollision(t,i)}}class P{constructor(){this.canvas=document.getElementById("game-canvas"),this.ctx=this.canvas.getContext("2d"),this.width=window.innerWidth,this.height=window.innerHeight,this.resize(),window.addEventListener("resize",()=>this.resize()),this.input=new M,this.renderer=new k(this.ctx,this.width,this.height),this.startScreen=document.getElementById("start-screen"),this.tutorialScreen=document.getElementById("tutorial-screen"),this.gameOverScreen=document.getElementById("game-over-screen"),this.startBtn=document.getElementById("start-btn"),this.tutorialBtn=document.getElementById("tutorial-btn"),this.closeTutorialBtn=document.getElementById("close-tutorial-btn"),this.restartBtn=document.getElementById("restart-btn"),this.startBtn.addEventListener("click",()=>this.start()),this.tutorialBtn.addEventListener("click",()=>this.showTutorial()),this.closeTutorialBtn.addEventListener("click",()=>this.hideTutorial()),this.restartBtn.addEventListener("click",()=>this.restart()),this.reset()}showTutorial(){this.startScreen.classList.add("hidden"),this.tutorialScreen.classList.remove("hidden")}hideTutorial(){this.tutorialScreen.classList.add("hidden"),this.startScreen.classList.remove("hidden")}reset(){this.player=new E(this.width/2,this.height-100),this.blocks=[],this.items=[],this.projectiles=[],this.floatingTexts=[],this.score=0,this.spawnTimer=0,this.scrollSpeed=100,this.spawnInterval=.8,this.gameTime=60,this.phase="scavenge",this.boss=null,this.lastTime=0,this.isRunning=!1,this.updateHUD(),this.renderer.clear(),this.renderer.drawPlayer(this.player)}resize(){this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.renderer&&this.renderer.resize(this.width,this.height)}start(){this.isRunning||(this.startScreen.classList.add("hidden"),this.gameOverScreen.classList.add("hidden"),this.isRunning=!0,this.lastTime=performance.now(),requestAnimationFrame(this.loop.bind(this)))}restart(){this.reset(),this.start()}loop(t){if(!this.isRunning)return;const i=(t-this.lastTime)/1e3;this.lastTime=t,this.update(i),this.draw(),requestAnimationFrame(this.loop.bind(this))}update(t){this.player.update(t,this.input),this.spawnTimer+=t,this.spawnTimer>this.spawnInterval&&(this.spawnBlock(),this.spawnTimer=0),this.blocks.forEach(i=>{i.update(t,this.scrollSpeed),i.active&&d.checkCollision(this.player,i)&&this.handleCollision(this.player,i)}),this.player.y>this.height-this.player.radius&&this.gameOver(),this.items.forEach(i=>{i.update(t,this.scrollSpeed),i.active&&d.checkCircleCollision(this.player,i)&&this.collectItem(i)}),this.projectiles.forEach(i=>{i.update(t),this.blocks.forEach(e=>{e.active&&d.checkCollision(i,e)&&(e.hp-=i.type==="beam"?.5:1,e.hp<=0&&(e.active=!1,this.spawnItem(e.x+e.width/2,e.y+e.height/2,e.type),this.score+=100),i.type!=="beam"&&(i.active=!1))}),this.boss&&this.phase==="boss"&&d.checkCollision(i,{x:this.boss.x,y:this.boss.y,width:this.boss.width,height:this.boss.height})&&(this.boss.hp-=i.type==="beam"?.5:1,this.boss.hp<=0&&this.gameWin(),i.type!=="beam"&&(i.active=!1))}),this.floatingTexts.forEach(i=>i.update(t)),this.player.isAttacking&&this.fireWeapon(t),this.blocks=this.blocks.filter(i=>i.active&&i.y<this.height+100),this.items=this.items.filter(i=>i.active&&i.y<this.height+100),this.projectiles=this.projectiles.filter(i=>i.active&&i.y>-100&&i.y<this.height),this.floatingTexts=this.floatingTexts.filter(i=>i.active),this.updateHUD(),this.phase==="scavenge"?(this.gameTime-=t,this.gameTime<=0&&this.startBossPhase()):this.phase==="boss"&&this.boss&&(this.boss.update(t,this.player),d.checkCollision(this.player,{x:this.boss.x,y:this.boss.y,width:this.boss.width,height:this.boss.height})&&(this.player.isCharging?(this.boss.hp-=this.player.atk,this.boss.hp<=0&&this.gameWin()):this.player.hp-=1))}startBossPhase(){this.phase="boss",this.blocks=[],this.items=[],this.boss=new S(this.width/2-50,50)}gameWin(){this.isRunning=!1,document.getElementById("game-over-screen").classList.remove("hidden"),document.querySelector("#game-over-screen h1").innerText="YOU WIN!",document.getElementById("final-score").innerText=this.score}spawnBlock(){if(this.phase!=="scavenge")return;const t=this.player.radius*4,i=t,e=Math.floor(this.width/t),s=(this.width-e*t)/2,h=Math.floor(Math.random()*e);let n=-1;Math.random()>.5&&(n=Math.floor(Math.random()*e));for(let c=0;c<e;c++){if(c===h||c===n)continue;const f=s+c*t,l=-i,a=Math.random()>.8?"hard":Math.random()>.8?"resource":"normal";this.blocks.push(new B(f,l,t,i,a))}}gameOver(){this.isRunning=!1,document.getElementById("game-over-screen").classList.remove("hidden"),document.querySelector("#game-over-screen h1").innerText="GAME OVER",document.getElementById("final-score").innerText=this.score}handleCollision(t,i){if(t.invincible||t.isShaking&&!t.isCharging&&!t.isAttacking){i.hp=0,i.active=!1,this.spawnItem(i.x+i.width/2,i.y+i.height/2,i.type),this.score+=100;return}if(t.isAttacking){const e=t.atk+t.chargePower;i.hp-=e,t.chargePower=Math.max(0,t.chargePower-1),i.hp<=0?(i.active=!1,this.spawnItem(i.x+i.width/2,i.y+i.height/2,i.type),this.score+=100):(t.isAttacking=!1,t.y+=10)}else t.y+=5}spawnItem(t,i,e){let s="hp";if(e==="resource"){const h=Math.random();h<.33?s="atk":h<.66?s="spd":s="def"}else if(Math.random()>.95)s="invincible";else if(Math.random()>.7)s="hp";else return;this.items.push(new I(t,i,s))}collectItem(t){t.active=!1;let i="",e=t.color;t.type==="invincible"?(this.player.invincible=!0,this.player.invincibleTimer=5,this.player.speed=800,i="INVINCIBLE!"):(this.player.upgrade(t.type),i=`+${t.type.toUpperCase()}`,t.type==="hp"&&(i="+20 HP")),this.spawnFloatingText(t.x,t.y,i,e),this.score+=50}fireWeapon(t){this.player.weaponTimer+=t;const i=this.player.weaponType;i==="beam"?this.player.weaponTimer>.05&&(this.projectiles.push(new p(this.player.x,this.player.y-20,0,-800,"beam")),this.player.weaponTimer=0):i==="gun"&&this.player.weaponTimer>.1&&(this.projectiles.push(new p(this.player.x-10,this.player.y,-50,-600,"bullet")),this.projectiles.push(new p(this.player.x+10,this.player.y,50,-600,"bullet")),this.player.weaponTimer=0)}updateHUD(){document.getElementById("score-val").innerText=this.score,document.getElementById("time-val").innerText=Math.ceil(this.gameTime),document.getElementById("atk-val").innerText=this.player.atk,document.getElementById("spd-val").innerText=Math.floor(this.player.speed),document.getElementById("def-val").innerText=this.player.def}draw(){this.renderer.clear(),this.blocks.forEach(t=>{t.active&&this.renderer.drawBlock(t)}),this.items.forEach(t=>{t.active&&this.renderer.drawItem(t)}),this.projectiles.forEach(t=>{t.active&&this.renderer.drawProjectile(t)}),this.floatingTexts.forEach(t=>{t.active&&this.renderer.drawFloatingText(t)}),this.boss&&this.phase==="boss"&&this.renderer.drawBoss(this.boss),this.renderer.drawPlayer(this.player)}spawnFloatingText(t,i,e,s){this.floatingTexts.push(new C(t,i,e,s))}}window.addEventListener("DOMContentLoaded",()=>{new P});
